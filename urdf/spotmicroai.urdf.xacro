<?xml version="1.0" encoding="UTF-8"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="SpotMicroAI">

   <xacro:include filename="include/constants.urdf.xacro"/>
   <xacro:include filename="include/inertias.urdf.xacro"/>

   <material name="yellow">
      <color rgba="0.92 0.83 0.0 1" />
   </material>
   <material name="black">
      <color rgba="0.1 0.1 0.1 1" />
   </material>
   <material name="grey">
      <color rgba="0.6 0.6 0.6 1" />
   </material>

   <!-- Macros -->
   <xacro:macro name="gen_shoulder" params="name left">
      <link name="${name}">
         <visual>
            <xacro:if value="${left}">
               <geometry>
                  <mesh filename="package://spotmicro_description/meshes/stl/lshoulder.stl" scale="0.001 0.001 0.001" />
               </geometry>
               <origin rpy="0 0 3.1416" xyz="0.135 0.0163 -0.0195" />
            </xacro:if>
            <xacro:unless value="${left}">
               <geometry>
                  <mesh filename="package://spotmicro_description/meshes/stl/rshoulder.stl" scale="0.001 0.001 0.001" />
               </geometry>
               <origin rpy="0 0 3.1416" xyz="0.135 0.0938 -0.0205" />
            </xacro:unless>
            <material name="black" />
         </visual>
         <collision>
            <geometry>
               <box size="${shoulder_length} ${shoulder_width} ${body_height}" />
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 0" />
         </collision>
         <xacro:inertial_cuboid mass="0.10" x_length="${shoulder_length}" y_length="${shoulder_width}" z_length="${body_height}"/>
      </link>
   </xacro:macro>
   <xacro:macro name="gen_shoulder_joint" params="pos shiftx shifty">
      <joint name="${pos}_shoulder" type="revolute">
         <parent link="base_link" />
         <child link="${pos}_shoulder_link" />
         <axis xyz="1 0 0" />
         <origin rpy="0 0 0" xyz="${shiftx} ${shifty} 0" />
         <limit effort="100.0" lower="-0.548" upper="0.548" velocity="0.7" />
      </joint>
      <transmission name="${pos}_shoulder_trans">
         <type>transmission_interface/SimpleTransmission</type>
         <joint name="${pos}_shoulder">
               <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
         </joint>
         <actuator name="${pos}_shoulder_actuator">
               <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
               <mechanicalReduction>1</mechanicalReduction>
         </actuator>
      </transmission>
   </xacro:macro>
   <xacro:macro name="gen_leg" params="name left">
      <link name="${name}_cover">
         <visual>
            <xacro:if value="${left}">
               <geometry>
                  <mesh filename="package://spotmicro_description/meshes/stl/larm_cover.stl" scale="0.001 0.001 0.001" />
               </geometry>
               <origin rpy="0 0 3.1416" xyz="0.134 -0.04 -0.0095" />
            </xacro:if>
            <xacro:unless value="${left}">
               <geometry>
                  <mesh filename="package://spotmicro_description/meshes/stl/rarm_cover.stl" scale="0.001 0.001 0.001" />
               </geometry>
               <origin rpy="0 0 3.1416" xyz="0.134 0.149 -0.0095" />
            </xacro:unless>
            <material name="yellow" />
         </visual>
      </link>
      <link name="${name}">
         <visual>
            <xacro:if value="${left}">
               <geometry>
                  <mesh filename="package://spotmicro_description/meshes/stl/larm.stl" scale="0.001 0.001 0.001" />
               </geometry>
               <origin rpy="0 0 3.1416" xyz="0.134 -0.04 -0.0095" />
            </xacro:if>
            <xacro:unless value="${left}">
               <geometry>
                  <mesh filename="package://spotmicro_description/meshes/stl/rarm.stl" scale="0.001 0.001 0.001" />
               </geometry>
               <origin rpy="0 0 3.1416" xyz="0.134 0.149 -0.0095" />
            </xacro:unless>
            <material name="black" />
         </visual>
         <collision>
            <origin rpy="0 0 0" xyz="0 0 -0.050" />
            <geometry>
               <box size="${leg_height} ${leg_width} ${leg_length}" />
            </geometry>
         </collision>
         <xacro:inertial_cuboid_with_pose mass="${leg_mass}" x_length="${leg_height}" y_length="${leg_width}" z_length="${leg_length}">
            <origin rpy="0 0 0" xyz="0 0 -0.050" />
         </xacro:inertial_cuboid_with_pose>
      </link>
      <gazebo reference="${name}_cover">
         <material>Gazebo/ZincYellow</material>
      </gazebo>
   </xacro:macro>
   <xacro:macro name="gen_leg_joint" params="pos shift">
      <joint name="${pos}_leg" type="revolute">
         <parent link="${pos}_shoulder_link" />
         <child link="${pos}_leg_link" />
         <axis xyz="0 1 0" />
         <origin rpy="0 0 0" xyz="0 ${shift} 0" />
         <limit effort="100.0" lower="-2.666" upper="1.548" velocity="0.5" />
      </joint>
      <transmission name="${pos}_leg_trans">
         <type>transmission_interface/SimpleTransmission</type>
         <joint name="${pos}_leg">
               <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
         </joint>
         <actuator name="${pos}_leg_actuator">
               <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
               <mechanicalReduction>1</mechanicalReduction>
         </actuator>
      </transmission>
      <joint name="${pos}_leg_cover_joint" type="fixed">
         <parent link="${pos}_leg_link" />
         <child link="${pos}_leg_link_cover" />
         <origin xyz="0 0 0" />
      </joint>
   </xacro:macro>
   <xacro:macro name="gen_foot" params="name left">
      <link name="${name}">
         <visual>
            <xacro:if value="${left}">
               <geometry>
                  <mesh filename="package://spotmicro_description/meshes/stl/lfoot.stl" scale="0.001 0.001 0.001" />
               </geometry>
               <origin rpy="0 0 3.1416 " xyz="0.1195 -0.04 0.099" />
            </xacro:if>
            <xacro:unless value="${left}">
               <geometry>
                  <mesh filename="package://spotmicro_description/meshes/stl/rfoot.stl" scale="0.001 0.001 0.001" />
               </geometry>
               <origin rpy="0 0 3.1416" xyz="0.1195 0.149 0.099" />
            </xacro:unless>
            <material name="black" />
         </visual>
         <collision>
            <geometry>
               <box size="${foot_height} ${foot_width} ${foot_length}" />
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 -0.050" />
         </collision>
         <xacro:inertial_cuboid_with_pose mass="${foot_mass}" x_length="${foot_height}" y_length="${foot_width}" z_length="${foot_length}">
            <origin rpy="0 0 0" xyz="0 0 -0.050" />
         </xacro:inertial_cuboid_with_pose>
      </link>
      <gazebo reference="${name}">
         <kp>100000.0</kp>
         <kd>1.0</kd>
         <mu1>0.8</mu1>
         <mu2>0.8</mu2>
         <maxVel>0.0</maxVel>
         <minDepth>0.001</minDepth>
      </gazebo>
   </xacro:macro>
   <xacro:macro name="gen_foot_joint" params="pos">
      <joint name="${pos}_foot" type="revolute">
         <parent link="${pos}_leg_link" />
         <child link="${pos}_foot_link" />
         <axis xyz="0 1 0" />
         <origin rpy="0 0 0" xyz="0.014 0 -${leg_length}" />
         <limit effort="100.0" lower="-1.7929" upper="0.254801" velocity="0.5" />
      </joint>
      <transmission name="${pos}_foot_trans">
         <type>transmission_interface/SimpleTransmission</type>
         <joint name="${pos}_foot">
               <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
         </joint>
         <actuator name="${pos}_foot_actuator">
               <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
               <mechanicalReduction>1</mechanicalReduction>
         </actuator>
      </transmission>
   </xacro:macro>
   <xacro:macro name="gen_toe" params="name">
      <link name="${name}">
         <visual>
            <geometry>
               <mesh filename="package://spotmicro_description/meshes/stl/foot.stl" scale="0.001 0.001 0.001" />
            </geometry>
            <origin rpy="0 0.40010 0" xyz="0 -0.01 0.005" />
            <material name="grey" />
         </visual>
         <collision>
            <geometry>
               <sphere radius="${toe_radius}" />
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 0" />
            <contact_coefficients mu="1.1" />
         </collision>
         <xacro:inertial_sphere mass="${toe_mass}" diameter="${toe_radius}"/>
      </link>
      <gazebo reference="${name}">
         <kp>100000.0</kp>
         <kd>1.0</kd>
         <mu1>1.0</mu1>
         <mu2>1.0</mu2>
         <maxVel>0.0</maxVel>
         <minDepth>0.001</minDepth>
      </gazebo>
   </xacro:macro>
   <xacro:macro name="gen_toe_joint" params="pos">
      <joint name="${pos}_toe" type="fixed">
         <parent link="${pos}_foot_link" />
         <child link="${pos}_toe_link" />
         <origin xyz="0 0 -${foot_length}" />
      </joint>
   </xacro:macro>
   <xacro:macro name="gen_full_leg_joint" params="pos shiftx shifty shift left">
      <xacro:gen_shoulder name="${pos}_shoulder_link" left="${left}" />
      <xacro:gen_leg name="${pos}_leg_link" left="${left}" />
      <xacro:gen_foot name="${pos}_foot_link" left="${left}" />
      <xacro:gen_toe name="${pos}_toe_link" />
      <xacro:gen_shoulder_joint pos="${pos}" shiftx="${shiftx}" shifty="${shifty}" />
      <xacro:gen_leg_joint pos="${pos}" shift="${shift}" />
      <xacro:gen_foot_joint pos="${pos}" />
      <xacro:gen_toe_joint pos="${pos}" />
   </xacro:macro>
   <!-- Robot Body -->
   <link name="base_link"/>
   <link name="base_inertia">
      <visual>
         <geometry>
            <mesh filename="package://spotmicro_description/meshes/stl/mainbody.stl" scale="0.001 0.001 0.001" />
         </geometry>
         <material name="black" />
         <origin rpy="0 0 3.1416" xyz="0.0425 0.055 -0.02" />
      </visual>
      <collision>
         <geometry>
            <box size="${body_length} ${body_width} ${body_height}" />
         </geometry>
         <origin rpy="0 0 3.1416" xyz="0 0 0" />
      </collision>
      <xacro:inertial_cuboid_with_pose mass="${body_mass}" x_length="${body_length}" y_length="${body_width}" z_length="${body_height}">
         <origin rpy="0 0 3.1416" xyz="0 0 0" />
      </xacro:inertial_cuboid_with_pose>
   </link>
   <joint name="base_inertia_joint" type="fixed">
      <parent link="base_link" />
      <child link="base_inertia" />
   </joint>
   <link name="rear_link">
      <visual>
         <geometry>
            <mesh filename="package://spotmicro_description/meshes/stl/backpart.stl" scale="0.001 0.001 0.001" />
         </geometry>
         <origin rpy="0 0 3.1416" xyz="0.042 0.055 -0.0195" />
         <material name="yellow" />
      </visual>
      <collision>
         <geometry>
            <box size="${rear_length} ${body_width} ${body_height}" />
         </geometry>
         <origin rpy="0 0 0" xyz="-0.135 0 0" />
      </collision>
      <xacro:inertial_cuboid_with_pose mass="0.20" x_length="${rear_length}" y_length="${body_width}" z_length="${body_height}">
         <origin rpy="0 0 0" xyz="-0.135 0 0" />
      </xacro:inertial_cuboid_with_pose>
   </link>
   <joint name="base_rear" type="fixed">
      <parent link="base_link" />
      <child link="rear_link" />
   </joint>
   <gazebo reference="rear_link">
      <material>Gazebo/ZincYellow</material>
   </gazebo>
   <link name="front_link">
      <visual>
         <geometry>
            <mesh filename="package://spotmicro_description/meshes/stl/frontpart.stl" scale="0.001 0.001 0.001" />
         </geometry>
         <origin rpy="0 0 3.1416" xyz="0.042 0.055 -0.0205" />
         <material name="yellow" />
      </visual>
      <collision>
         <geometry>
            <box size="${front_length} ${body_width} ${body_height}" />
         </geometry>
         <origin rpy="0 0 0" xyz="0.135 0 0" />
      </collision>
      <xacro:inertial_cuboid_with_pose mass="0.20" x_length="${front_length}" y_length="${body_width}" z_length="${body_height}">
         <origin rpy="0 0 0" xyz="0.135 0 0" />
      </xacro:inertial_cuboid_with_pose>
   </link>
   <gazebo reference="front_link">
      <material>Gazebo/ZincYellow</material>
   </gazebo>
   <joint name="base_front" type="fixed">
      <parent link="base_link" />
      <child link="front_link" />
   </joint>
   <!-- create Legs -->
   <xacro:gen_full_leg_joint pos="front_left"  shiftx=" ${shiftx}" shifty=" ${shifty}" shift=" ${shift}" left="true"  />
   <xacro:gen_full_leg_joint pos="front_right" shiftx=" ${shiftx}" shifty="-${shifty}" shift="-${shift}" left="false" />
   <xacro:gen_full_leg_joint pos="rear_left"   shiftx="-${shiftx}" shifty=" ${shifty}" shift=" ${shift}" left="true"  />
   <xacro:gen_full_leg_joint pos="rear_right"  shiftx="-${shiftx}" shifty="-${shifty}" shift="-${shift}" left="false" />

   <!-- Optional custom includes. -->
   <xacro:include filename="$(optenv SPOT_URDF_EXTRAS empty.urdf)" />
   <xacro:include filename="include/accessories.urdf.xacro" />

   <!-- Gazebo plugins -->
   <gazebo>
      <plugin name="p3d_base_controller" filename="libgazebo_ros_p3d.so">
            <alwaysOn>true</alwaysOn>
            <updateRate>10.0</updateRate>
            <bodyName>base_link</bodyName>
            <topicName>odom/ground_truth</topicName>
            <gaussianNoise>0.01</gaussianNoise>
            <frameName>world</frameName>
            <xyzOffsets>0 0 0</xyzOffsets>
            <rpyOffsets>0 0 0</rpyOffsets>
        </plugin>
    </gazebo>

    <gazebo>
        <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
            <legacyModeNS>true</legacyModeNS>
        </plugin>
    </gazebo>

</robot>
