<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro">

  <xacro:include filename="$(find spotmicro_description)/urdf/include/constants.urdf.xacro"/>

  <xacro:macro name="gen_shoulder" params="name left">
    <link name="${name}">
        <visual>
          <xacro:if value="${left}">
              <geometry>
                <mesh filename="package://spotmicro_description/meshes/stl/lshoulder.stl" scale="0.001 0.001 0.001" />
              </geometry>
              <origin rpy="0 0 3.1416" xyz="0.135 0.0163 -0.0195" />
          </xacro:if>
          <xacro:unless value="${left}">
              <geometry>
                <mesh filename="package://spotmicro_description/meshes/stl/rshoulder.stl" scale="0.001 0.001 0.001" />
              </geometry>
              <origin rpy="0 0 3.1416" xyz="0.135 0.0938 -0.0205" />
          </xacro:unless>
          <material name="black" />
        </visual>
        <collision>
          <geometry>
              <box size="${shoulder_length} ${shoulder_width} ${body_height}" />
          </geometry>
          <origin rpy="0 0 0" xyz="0 0 0" />
        </collision>
        <inertial>
          <mass value="0.10" />
          <inertia ixx="100" ixy="0" ixz="0" iyy="100" iyz="0" izz="100" />
        </inertial>
    </link>
  </xacro:macro>
  <xacro:macro name="gen_shoulder_joint" params="pos shiftx shifty">
    <joint name="${pos}_shoulder" type="revolute">
        <parent link="base_link" />
        <child link="${pos}_shoulder_link" />
        <axis xyz="1 0 0" />
        <origin rpy="0 0 0" xyz="${shiftx} ${shifty} 0" />
        <limit effort="1000.0" lower="-0.548" upper="0.548" velocity="0.7" />
        <dynamics damping="0.0" friction="0.5" />
    </joint>
    <transmission name="${pos}_shoulder_transmission">
      <type>transmission_interface/SimpleTransmission</type>
      <joint name="${pos}_shoulder">
          <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      </joint>
      <actuator name="${pos}_shoulder_actuator">
          <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
          <mechanicalReduction>1</mechanicalReduction>
      </actuator>
    </transmission>
  </xacro:macro>
  <xacro:macro name="gen_leg" params="name left">
    <link name="${name}_cover">
        <visual>
          <xacro:if value="${left}">
              <geometry>
                <mesh filename="package://spotmicro_description/meshes/stl/larm_cover.stl" scale="0.001 0.001 0.001" />
              </geometry>
              <origin rpy="0 0 3.1416" xyz="0.134 -0.04 -0.0095" />
          </xacro:if>
          <xacro:unless value="${left}">
              <geometry>
                <mesh filename="package://spotmicro_description/meshes/stl/rarm_cover.stl" scale="0.001 0.001 0.001" />
              </geometry>
              <origin rpy="0 0 3.1416" xyz="0.134 0.149 -0.0095" />
          </xacro:unless>
          <material name="yellow" />
        </visual>
    </link>
    <link name="${name}">
        <visual>
          <xacro:if value="${left}">
              <geometry>
                <mesh filename="package://spotmicro_description/meshes/stl/larm.stl" scale="0.001 0.001 0.001" />
              </geometry>
              <origin rpy="0 0 3.1416" xyz="0.134 -0.04 -0.0095" />
          </xacro:if>
          <xacro:unless value="${left}">
              <geometry>
                <mesh filename="package://spotmicro_description/meshes/stl/rarm.stl" scale="0.001 0.001 0.001" />
              </geometry>
              <origin rpy="0 0 3.1416" xyz="0.134 0.149 -0.0095" />
          </xacro:unless>
          <material name="black" />
        </visual>
        <collision>
          <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 -0.050" />
          <geometry>
              <box size="0.028 0.036 ${leg_length}" />
          </geometry>
        </collision>
        <inertial>
          <mass value="0.15" />
          <inertia ixx="1000" ixy="0" ixz="0" iyy="1000" iyz="0" izz="1000" />
        </inertial>
    </link>
    <gazebo reference="${name}_cover">
        <material>Gazebo/ZincYellow</material>
    </gazebo>
  </xacro:macro>
  <xacro:macro name="gen_leg_joint" params="pos shift">
    <joint name="${pos}_leg" type="revolute">
        <parent link="${pos}_shoulder_link" />
        <child link="${pos}_leg_link" />
        <axis xyz="0 1 0" />
        <origin rpy="0 0 0" xyz="0 ${shift} 0" />
        <limit effort="1000.0" lower="-2.666" upper="1.548" velocity="0.5" />
        <dynamics damping="0.0" friction="0.0" />
    </joint>
    <transmission name="${pos}_leg_transmission">
      <type>transmission_interface/SimpleTransmission</type>
      <joint name="${pos}_leg">
          <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      </joint>
      <actuator name="${pos}_leg_actuator">
          <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
          <mechanicalReduction>1</mechanicalReduction>
      </actuator>
    </transmission>
    <joint name="${pos}_leg_cover_joint" type="fixed">
        <parent link="${pos}_leg_link" />
        <child link="${pos}_leg_link_cover" />
        <origin xyz="0 0 0" />
    </joint>
  </xacro:macro>
  <xacro:macro name="gen_foot" params="name left">
    <link name="${name}">
        <visual>
          <xacro:if value="${left}">
              <geometry>
                <mesh filename="package://spotmicro_description/meshes/stl/lfoot.stl" scale="0.001 0.001 0.001" />
              </geometry>
              <origin rpy="0 0 3.1416 " xyz="0.1195 -0.04 0.099" />
          </xacro:if>
          <xacro:unless value="${left}">
              <geometry>
                <mesh filename="package://spotmicro_description/meshes/stl/rfoot.stl" scale="0.001 0.001 0.001" />
              </geometry>
              <origin rpy="0 0 3.1416" xyz="0.1195 0.149 0.099" />
          </xacro:unless>
          <material name="black" />
        </visual>
        <collision>
          <geometry>
              <box size="0.026 0.020 ${foot_length}" />
          </geometry>
          <origin rpy="0.0 0.0 0.0" xyz="0.0 0.0 -0.050" />
        </collision>
        <inertial>
          <mass value="0.1" />
          <inertia ixx="1000" ixy="0" ixz="0" iyy="1000" iyz="0" izz="1000" />
        </inertial>
    </link>
  </xacro:macro>
  <xacro:macro name="gen_foot_joint" params="pos">
    <joint name="${pos}_foot" type="revolute">
        <parent link="${pos}_leg_link" />
        <child link="${pos}_foot_link" />
        <axis xyz="0 1 0" />
        <origin rpy="0 0 0" xyz="0.014 0 -${leg_length}" />
        <limit effort="1000.0" lower="-0.1" upper="2.59" velocity="0.5" />
        <dynamics damping="0.0" friction="0.5" />
    </joint>
    <transmission name="${pos}_foot_transmission">
      <type>transmission_interface/SimpleTransmission</type>
      <joint name="${pos}_foot">
          <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      </joint>
      <actuator name="${pos}_foot_actuator">
          <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
          <mechanicalReduction>1</mechanicalReduction>
      </actuator>
    </transmission>
  </xacro:macro>
  <xacro:macro name="gen_toe" params="name">
    <link name="${name}">
        <visual>
          <geometry>
              <mesh filename="package://spotmicro_description/meshes/stl/foot.stl" scale="0.001 0.001 0.001" />
          </geometry>
          <origin rpy="0 0.40010 0" xyz="0 -0.01 0.015" />
          <material name="grey" />
        </visual>
        <collision>
          <geometry>
              <sphere radius="${toe_radius}" />
          </geometry>
          <origin rpy="0 0 0" xyz="0 0 0" />
          <contact_coefficients mu="1.1" />
        </collision>
        <inertial>
          <mass value="0.05" />
          <inertia ixx="1000" ixy="0" ixz="0" iyy="1000" iyz="0" izz="1000" />
        </inertial>
    </link>
  </xacro:macro>
  <xacro:macro name="gen_toe_joint" params="pos">
    <joint name="${pos}_toe" type="fixed">
        <parent link="${pos}_foot_link" />
        <child link="${pos}_toe_link" />
        <origin xyz="0 0 -${foot_length}" />
    </joint>
  </xacro:macro>
  <xacro:macro name="gen_full_leg_joint" params="pos shiftx shifty shift left">
    <xacro:gen_shoulder name="${pos}_shoulder_link" left="${left}" />
    <xacro:gen_leg name="${pos}_leg_link" left="${left}" />
    <xacro:gen_foot name="${pos}_foot_link" left="${left}" />
    <xacro:gen_toe name="${pos}_toe_link" />
    <xacro:gen_shoulder_joint pos="${pos}" shiftx="${shiftx}" shifty="${shifty}" />
    <xacro:gen_leg_joint pos="${pos}" shift="${shift}" />
    <xacro:gen_foot_joint pos="${pos}" />
    <xacro:gen_toe_joint pos="${pos}" />
  </xacro:macro>

</robot>